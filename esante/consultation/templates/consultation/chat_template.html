{% load static %}
<div class="flex flex-row space-x-5 items-center justify-center h-full p-5 ">

  <!-- React App Container for the other React component -->  
  <div id="react-app-chat" class="h-full w-1/2 rounded-lg overflow-hidden shadow-md "></div>

  <!-- Button to show 2nd panel -->
  <button id="show-panel-btn" class="h-14 w-14 bg-gray-300 text-white text-4xl rounded-full shadow-md flex items-center justify-center opacity-50 hover:opacity-100 ">
    +
  </button>

  <!-- 2nd panel (hidden initially) -->
  <div id="second-panel" class="hidden h-full w-1/2 bg-gray-200 rounded-lg overflow-hidden shadow-md  flex-col  transition-all duration-500">
    <div class="bg-gray-500 p-4 flex justify-between items-center">
      <select id="dropdown" class="bg-white text-gray-700 p-2 rounded-lg w-1/3">
        <option value="" selected disabled>---</option>
        {% if user.user_type == 'medecin' %}
        <option value="ia-assistant">IA assistant</option>
        {% endif %}
        <option value="medical-record">Dossier médical</option>
        <option value="consultation-planning">Planning de consultation</option>
      </select>
      <button id="close-panel-btn" class="text-white hover:text-red-500 hover:underline transition-all">Fermer</button>
    </div>
    <div id="ia-assistant" class="hidden h-full w-full">
      {% include 'consultation/ia_assistant.html' %}
    </div>
    <!-- Div du bas qui prend le reste de la hauteur -->
    <div class="flex-grow m-4" id="content-area">
      
      <!-- Le contenu pour les autres options sera inséré ici via AJAX -->
    </div>
    <!-- Div pour l'IA assistant, caché par défaut -->
    
  </div>
  
</div>

<script>
  window.currentUser = "{{ request.user.username }}";  // Injecte le nom d'utilisateur actuel
  window.memberId = "{{ membre.id }}";  // Injecte l'ID du membre (sélectionné ou connecté)
  window.userType = "{{request.user.user_type}}"; //

  const showPanelBtn = document.getElementById('show-panel-btn');
  const secondPanel = document.getElementById('second-panel');
  const closePanelBtn = document.getElementById('close-panel-btn');
  const dropdown = document.getElementById('dropdown');
  const contentArea = document.getElementById('content-area');
  const iaAssistantDiv = document.getElementById('ia-assistant');

  // Show second panel and hide "+" button
  showPanelBtn.addEventListener('click', function() {
    secondPanel.classList.remove('hidden');
    showPanelBtn.classList.add('hidden');
  });

  // Close second panel and show "+" button
  closePanelBtn.addEventListener('click', function() {
    secondPanel.classList.add('hidden');
    showPanelBtn.classList.remove('hidden');
  });

  // Dropdown selection logic
  dropdown.addEventListener('change', function() {
    const value = this.value;
    const memberId = window.memberId;

    // Gérer le cas où IA assistant est sélectionné
    if (value === 'ia-assistant') {
      iaAssistantDiv.classList.remove('hidden');  // Afficher le div IA assistant
      contentArea.innerHTML = '';  // Vider le reste du contenu dans le content-area
      contentArea.classList.add('hidden');  // Afficher le div IA assistant
    } else {
      iaAssistantDiv.classList.add('hidden');  // Cacher le div IA assistant
      contentArea.classList.remove('hidden'); 
      let url = '';

      // Charger les autres options via AJAX
      if (value === 'medical-record') {
        url = `/dossier-medical/${memberId}/`;
      } else if (value === 'consultation-planning') {
        url = '/planning-consultations/';
      }

      // Charger la page partiellement via AJAX
      if (url) {
        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
          .then(response => response.text())
          .then(html => {
            contentArea.innerHTML = html;  // Insérer le contenu HTML chargé
          })
          .catch(error => {
            console.error('Erreur lors du chargement via AJAX:', error);
          });
      }
    }
  });

  // Initialiser la sélection par défaut au chargement de la page
  window.onload = function() {
    dropdown.value = "";  // Sélectionner l'option vide par défaut
  };
</script>

<!-- Include the Vite-built React app -->
<link rel="stylesheet" href="{% static 'react/assets/index-01.css' %}">
<script type="module" src="{% static 'react/assets/index-01.js' %}"></script>