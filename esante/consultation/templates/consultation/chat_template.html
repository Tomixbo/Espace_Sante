{% load static %}
<div class="flex flex-row space-x-5 items-center justify-center h-full p-5 ">

  <!-- React App Container -->  
  <div id="react-app-chat" class="h-full w-1/2 rounded-lg overflow-hidden shadow-md "></div>

  <!-- Button to show 2nd panel -->
  <button id="show-panel-btn" class="h-14 w-14 bg-gray-300 text-white text-4xl rounded-full shadow-md flex items-center justify-center opacity-50 hover:opacity-100 ">
    +
  </button>
  
  <!-- 2nd panel (hidden initially) -->
  <div id="second-panel" class="h-full w-1/2 bg-gray-200 rounded-lg overflow-hidden shadow-md flex flex-col hidden transition-all duration-500">
    
    <!-- Div du haut avec la liste déroulante -->
    <div class="bg-gray-500 p-4 flex justify-between items-center">
      <select id="dropdown" class="bg-white text-gray-700 p-2 rounded-lg w-1/3">
        <!-- Option vide par défaut -->
        <option value="" selected disabled>---</option>
        {% if user.user_type == 'medecin' %}
        <option value="ia-assistant">IA assistant</option>
        {% endif %}
        <option value="medical-record">Dossier médical</option>
        <option value="consultation-planning">Planning de consultation</option>
      </select>
      <!-- Text "Fermer" to close the panel -->
      <button id="close-panel-btn" class="text-white hover:text-red-500 hover:underline transition-all">Fermer</button>
    </div>
    
    <!-- Div du bas qui prend le reste de la hauteur -->
    <div class="flex-grow m-4 " id="content-area">
      <!-- Ici sera le contenu qui change selon la sélection dans la liste déroulante -->
    </div>
  </div>
  
</div>

<script>
  window.currentUser = "{{ request.user.username }}";  // Injecte le nom d'utilisateur actuel
  window.memberId = "{{ membre.id }}";  // Injecte l'ID du membre (sélectionné ou connecté)

  // Elements
  const showPanelBtn = document.getElementById('show-panel-btn');
  const secondPanel = document.getElementById('second-panel');
  const closePanelBtn = document.getElementById('close-panel-btn');
  const chatPanel = document.getElementById('react-app-chat');

  // Show second panel and hide "+" button with animation
  showPanelBtn.addEventListener('click', function() {
    secondPanel.classList.remove('hidden');
    showPanelBtn.classList.add('hidden');
  });

  // Close second panel and show "+" button with animation
  closePanelBtn.addEventListener('click', function() {
    secondPanel.classList.add('hidden');
    showPanelBtn.classList.remove('hidden');
  });

  // Ajouter un gestionnaire d'événement pour la liste déroulante
  document.getElementById('dropdown').addEventListener('change', function() {
    const value = this.value;
    const contentArea = document.getElementById('content-area');
    const memberId = window.memberId;

    let url = '';
    if (value === 'ia-assistant') {
      url = '/ia-assistant/';
    } else if (value === 'medical-record') {
      url = `/dossier-medical/${memberId}/`;
    } else if (value === 'consultation-planning') {
      url = '/planning-consultations/';
    }

    // Envoyer la requête AJAX pour charger la page partielle
    fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
      .then(response => response.text())
      .then(html => {
        contentArea.innerHTML = html;
      })
      .catch(error => {
        console.error('Erreur:', error);
      });
  });

  // Initialiser la sélection par défaut au chargement de la page
  window.onload = function() {
    const dropdown = document.getElementById('dropdown');
    dropdown.value = "";  // Sélectionner l'option vide par défaut
  };
</script>

<!-- Include the Vite-built React app -->
<link rel="stylesheet" href="{% static 'react/assets/index-01.css' %}">
<script type="module" src="{% static 'react/assets/index-01.js' %}"></script>
